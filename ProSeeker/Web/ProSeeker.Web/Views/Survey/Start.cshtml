@model ProSeeker.Web.ViewModels.Quizzes.SurveyViewModel

<style>
    img {
        min-width: 50px;
        max-width: 300px;
        min-height: 50px;
        max-height: 360px;
    }

    .choices-letter {
        font-size: 20px;
        color: rgb(110, 97, 97);
        text-shadow: 0.5px 1px 1px rgb(4, 44, 17);
        display: inline-block;
        text-align: left;
        border: 1px solid rgb(255, 254, 254);
        border-radius: 25px;
        cursor: pointer;
        padding: 10px;
        padding-right: 0px;
    }

        .choices-letter:hover {
            cursor: pointer;
            background-color: #e3f1f8;
            font-weight: bold;
        }

    .choices:hover {
        cursor: pointer;
    }

    #survey-question {
        font-size: 25px;
        color: rgb(24, 134, 92);
        text-shadow: 1.1px 1px 1px rgb(8, 12, 71);
    }

    #survey-container {
        /*margin: 10px auto;*/
        border-radius: 5px;
        -webkit-box-shadow: -5px 6px 8px 0px rgba(74, 83, 14, 0.92);
        -moz-box-shadow: -5px 6px 8px 0px rgba(74, 83, 14, 0.92);
        box-shadow: -5px 6px 8px 0px rgba(74, 83, 14, 0.92);
        opacity: 0.96;
    }

    #survey-timer {
        position: absolute;
        height: 100px;
        width: 200px;
        bottom: 0px;
        text-align: center;
    }

    #survey-counter {
        font-size: 3em;
    }

    #survey-progress {
        width: 500px;
        position: absolute;
        bottom: 0px;
        right: 0px;
        padding: 5px;
        text-align: right;
    }

    .prog {
        width: 30px;
        height: 30px;
        border: 1px solid #000;
        display: inline-block;
        border-radius: 50%;
        margin-left: 15px;
        margin-right: 15px;
    }
</style>

<div class="row">
    <div id="survey-container" class="col-md-12">
        <div class="exit-survey-wrapper">
            <a class="exit-survey-btn">X</a>
        </div>
        @*<p class='survey-intro text-center'>Благодарим, че допринасяте за подобряването на нашата платформа!</p>*@
        @*<p class="start-survey text-center"> Анкетата ще започне след: <br><br><span id="countdowntimer">5 </span></p>*@

        @*Loading timer*@
        <div class="progress-load-wrapper">
            <div class="progress-load"></div>
        </div>

        <div id="survey-content" style="display: block" class="row">
            @foreach (var question in Model.Questions)
            {
                <div class="question-@question.Number" style="display: none;">

                    <div id="survey-question" class="col-md-12 text-center">@question.Text</div>
                    <div class="row mt-1">
                        <div id="survey-qImg" class="col-md-3 d-inline ml-3"></div>
                        <div id="survey-choice-container" class="col-md-8 float-left">
                            @{ var counter = 1;}

                            <div class="answers-container" onclick="LoadNextQuestion(@question.Number, @Model.Questions.Count(), event)">

                                @foreach (var answer in question.Answers)
                                {
                                    <label class="choices-letter col-md-11 float-left d-inline mt-1choices d-inline">@counter) @answer.Text</label>
                                    counter++;
                                }
                            </div>
                            <a class="fa fa-backward col-md-12 mt-5 survey-backward-btn" onclick="GetPreviousQuestion(@question.Number, @Model.Questions.Count(), event)" style="font-size:20px;"></a>

                        </div>
                    </div>
                </div>
            }
            <input hidden class="questionsCount" value=@Model.Questions.Count() />

        </div>
        <div class="endOfQuizAppearance" style="display:none;">
            <h2 class="text-center custom-golden-text">
                Благодарим, че помогнахте да подобрим нашата платформа!
            </h2>
            <p class="inquiry-notes  mt-5">
                <strong>Успешно попълнихте нашата анкета!</strong> <br />

                Ако сте специалист: <br />
                - профилът Ви ще бъде ВИП за седмица и ще се показва преди всички останали. <br />

                Ако сте потребител:<br />
                - Обявите Ви ще бъдат ВИП и ще се показват преди всички останали.<br />
            </p>
            <form asp-controller="Survey" asp-action="End">
                <div class="user-answers">
                    <input hidden />
                </div>
                <br /><br /><br /><br />
                <div class="text-center">
                    <button class="btn col-md-6 mb-2 custom-btn-no-background" type="submit">Потвърди</button>
                    <input hidden name="surveyId" asp-for="@Model.Id" />
                </div>
            </form>
        </div>
    </div>
</div>


<script asp-append-version="true">
    (function () {
        // Make first quesiton visible
        let firstQuestion = document.querySelector('.question-1');
        firstQuestion.style.display = "block"
    })()

    function GetPreviousQuestion(currentQuestionNum) {
        // Check if there are any previous questions. If any, hide current one and show the previous
        if (currentQuestionNum > 1) {
            let currentQuestion = document.querySelector(`.question-${currentQuestionNum}`);
            currentQuestion.style.display = "none";

            let previousQuestionNumber = Number(currentQuestionNum) - 1;
            let previousQuestion = document.querySelector(`.question-${previousQuestionNumber}`);
            previousQuestion.style.display = "block";
        }
    }

    function LoadNextQuestion(currentQuestionNum, numberOfQuestion, event) {
        let currentAnswer = event.target;
        if (currentAnswer.nodeName !== "LABEL") {
            return;
        }

        // Hide current question
        let currentQuestion = document.querySelector(`.question-${currentQuestionNum}`);
        currentQuestion.style.display = "none";

        // Unhide next question if there is any. Otherwise, show the end of the survey
        if (currentQuestionNum >= numberOfQuestion) {
            let endTextContainer = document.querySelector('.endOfQuizAppearance');
            endTextContainer.style.display = "block";
            return;

        } else {
            let nextQuestionNumber = Number(currentQuestionNum) + 1;
            let nextQuestion = document.querySelector(`.question-${nextQuestionNumber}`);
            nextQuestion.style.display = "block";
        }
    }
</script>
